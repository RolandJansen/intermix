<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous"
    >
    <link rel="stylesheet" href="assets/css/bootstrap-slider.css" media="screen" title="no title" charset="utf-8">
    <link rel="stylesheet" href="assets/css/demos.css" media="screen" title="no title" charset="utf-8">
    <script type="text/javascript" src="https://code.createjs.com/preloadjs-0.6.2.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/6.0.5/bootstrap-slider.js"></script>
    <script type="text/javascript" src="../dist/intermix.js"></script>
  </head>
  <body>

    <div class="container row">
      <div class="nav col-md-4">
        <h3>Demos:</h3>
        <ul>
          <li>Basic Routing</li>
        </ul>
      </div>
      <div class="demo col-md-8">
        <h1>Basic Routing</h1>
        <p>
          This demo plays a sound, volume is adjustable. Technically it's like this:
        </p>
        <p>
          <code>AudioBufferSourceNode -> GainNode -> AudioDestinationNode</code>
        </p>
        <form>
          <input class="btn btn-default" type="button" value="Start" onclick="playAudio('start')">
          <input class="btn btn-default" type="button" value="Stop" onclick="playAudio('stop')">
          Volume:
          <input id="gain"
          data-slider-id='gainSlider'
          type="text"
          data-slider-min="0"
          data-slider-max="1"
          data-slider-step="0.1"
          data-slider-value="1"
          onchange="changeGain()"
          >
          <div class="checkbox">
            <label>
              <input type="checkbox" id="loop" value="">loop
            </label>
          </div>
        </form>
      </div>
    </div>
    <footer>
      <!-- <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a><br> -->
      Audio material licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
      Copyright by <a href="https://freesound.org/people/bebeto/">bebeto</a>.
    </footer>

    <script type="text/javascript">
      var slider = new Slider('#gain', {
                    formatter: function(value) {
                        return 'Current value: ' + value;
                    }
      });

      var im = new Intermix();
      var audioLoop;
      var audioBuffer;
      var gain = im.audioCtx.createGain();
      gain.connect(im.audioCtx.destination);

      function handleFileComplete(e) {
        audioLoop = e.result;
        console.log('Audioloop loaded.');
        setupAudio(audioLoop);
      };

      function setupAudio(buffer) {
        im.audioCtx.decodeAudioData(buffer, function(decoded) {
          audioBuffer = decoded;
        });

      };

      function playAudio(state) {
        var loop = document.getElementById('loop').checked;

        if (state === 'start') {
          audioLoop = null;
          audioLoop = im.audioCtx.createBufferSource();
          audioLoop.buffer = audioBuffer;
          audioLoop.connect(gain);
          audioLoop.loop = loop;
          audioLoop.start();
        } else {

          if (audioLoop !== null) {
            audioLoop.stop();
            audioLoop = null;
          }
        }

      };

      // change gain
      slider.on('slide', function(e) {
        gain.gain.value = e;
      });

      (function() {
        console.log('loading sample.');
        var queue = new createjs.LoadQueue();
        queue.addEventListener('fileload', handleFileComplete);
        queue.loadFile({src:'assets/samples/554__bebeto__ambient-loop.mp3', type:createjs.AbstractLoader.BINARY});
      })();
    </script>
  </body>
</html>
