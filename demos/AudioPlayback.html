<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Intermix Demo</title>
    <link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous"
    >
    <link rel="stylesheet" href="assets/css/bootstrap-slider.css" media="screen" title="no title" charset="utf-8">
    <link rel="stylesheet" href="assets/css/demos.css" media="screen" title="no title" charset="utf-8">
    <script type="text/javascript" src="https://code.createjs.com/preloadjs-0.6.2.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/6.0.5/bootstrap-slider.js"></script>
    <script type="text/javascript" src="../dist/intermix.js"></script>
  </head>
  <body>

    <div class="container row">
      <div class="nav col-md-4">
        <h3>Demos:</h3>
        <ul class="nav nav-pills nav-stacked">
          <li role="presentation" class="active"><a href="#">Audio Playback</a></li>
          <li role="presentation"><a href="StepSequencer.html">Stepsequencer</a></li>
        </ul>
      </div>
      <div class="demo col-md-8">
        <h1>Audio Playback</h1>
        <div class="panel panel-primary">
          <div class="panel-heading">
            This demo plays a sound that can be looped. Volume and panning is adjustable.
          </div>
          <div class="panel-body">
            <form>
              <input class="btn btn-default" type="button" value="Start" onclick="play()">
              <input class="btn btn-default" type="button" value="Stop" onclick="stop()">
              <input class="btn btn-default" type="button" value="Pause" onclick="pause()">
              <br><br>
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="loop" value="">loop
                </label>
              </div><br>
              Loop Range:<br>
              <input id="loopRange"
              data-slider-id='gainSlider'
              type="text"
              data-slider-min="0"
              data-slider-max="1"
              data-slider-step="0.01"
              data-slider-value="[0, 1]"
              ><br><br>
              Volume:<br>
              <input id="gain"
              data-slider-id='gainSlider'
              type="text"
              data-slider-min="0"
              data-slider-max="1"
              data-slider-step="0.1"
              data-slider-value="1"
              ><br><br>
              Stereo Position:<br>
              <input id="pan"
              data-slider-id='panSlider'
              type="text"
              data-slider-min="-1"
              data-slider-max="1"
              data-slider-step="0.1"
              data-slider-value="0"
              >
            </form>
          </div>
          <div class="panel-footer">
            Audio material licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
            Copyright by <a href="https://freesound.org/people/bebeto/">bebeto</a>.
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      var gainSlider = new Slider('#gain', {
                    formatter: function(value) {
                        return 'Current value: ' + value;
                    }
      });

      var panSlider = new Slider('#pan', {
                    formatter: function(value) {
                        return 'Current value: ' + value;
                    }
      });

      var loopSlider = new Slider('#loopRange', {
                    formatter: function(value) {
                        return 'Current value: ' + value;
                    }
      });

      var audioCtx = Intermix.audioCtx;
      var sound;

      function handleFileComplete(e) {
        var audioFile = e.result;
        console.log(audioFile);
        var soundWave = new Intermix.SoundWave(audioCtx, audioFile);
        // this is crap and needs to be fixed asap!
        setTimeout(function() {
          sound = new Intermix.Sound(audioCtx, soundWave.buffer);
        }, 500);
      };

      function play() {
        var loop = document.getElementById('loop').checked;
        sound.play(loop);
      }

      function stop() {
        sound.stop();
      }

      function pause() {
        sound.pause();
      }

      // change gain
      gainSlider.on('slide', function(e) {
        sound.gainNode.gain.value = e;
      });

      panSlider.on('slide', function(e) {
        sound.pannerNode.pan.value = e;
      });

      loopSlider.on('slide', function(e) {
        sound.setLoopStart(e[0]);
        sound.setLoopEnd(e[1]);
      });

      (function() {
        var queue = new createjs.LoadQueue();
        queue.addEventListener('fileload', handleFileComplete);
        queue.loadFile({src:'assets/samples/554__bebeto__ambient-loop.mp3', type:createjs.AbstractLoader.BINARY});
      })();
    </script>
  </body>
</html>
