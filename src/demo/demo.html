<html>
    <head>
        <title>Sequencer Demo</title>
        <style>
            #blink {
                width: 20px;
                height: 20px;
                border-style: solid;
            }
        </style>
    </head>
    <body onload="init();">
        <button id="resumeAudioContext">resume audio context</button>
        <button id="start">start</button>
        <button id="stop">stop</button>
        <button id="setbpm">set bpm to 180</button>
        <button id="getstate">get current state</button>
        <div id="blink"></div>
    </body>
    <script>
        const allActionCreators = intermix.getActionCreators();
        let synthUID = "";
        let seqUID = "";
        let seqActionCreators = {};

        function init() {
            for (const uid in allActionCreators) {
                if (allActionCreators[uid].metadata.name === "Intermix Sequencer") {
                    seqUID = uid;
                    seqActionCreators = allActionCreators[uid].actionCreators;
                }
                if (allActionCreators[uid].metadata.name === "Demo Synth") {
                    synthUID = uid;
                }
            }

            // make a part and add it to the sequencer
            const note = {
                value: 64,
                velocity: 1,
                steps: 4,
                duration: 0,
            }
            const noteAction = {
                type: "NOTE",
                dest: synthUID,
                payload: note,
            }
            const attackAction = {
                type: "ENV_ATTACK",
                dest: synthUID,
                payload: { value: 0.3 },
            }

            const part = intermix.getNewPart();
            part.addAction(noteAction, 3)
                // .addAction(attackAction, 5)
                .addAction(noteAction, 7)
                .addAction(noteAction, 11);

            seqActionCreators["ADD_PART"]({ part, position: 0 });

            const animeTest = (step) => {
                let blinker = document.getElementById("blink");
                if (step % 16 === 0) {
                    blinker.style.backgroundColor = "red";
                } else {
                    blinker.style.backgroundColor = "white";
                }
            }
            intermix.animate(animeTest);
        }

        document.getElementById('resumeAudioContext').addEventListener('click', () => {
            intermix.resumeAudioContext();
            console.log("Audio Context Resumed");
        });

        document.getElementById('start').addEventListener('click', () => {
            seqActionCreators["STATE"](1);
        })

        document.getElementById('stop').addEventListener('click', () => {
            seqActionCreators["STATE"](0);
        })

        document.getElementById("getstate").addEventListener('click', () => {
            console.log(intermix.getState());
        })

        document.getElementById("setbpm").addEventListener('click', () => {
            seqActionCreators["BPM"](180);
        })
    </script>
</html>