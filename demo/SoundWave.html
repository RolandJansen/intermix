<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Intermix Demo</title>
    <link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous"
    >
    <link rel="stylesheet" href="assets/css/demos.css" media="screen" title="no title" charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.0/css/bootstrap-slider.css" media="screen" title="no title" charset="utf-8">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.0/bootstrap-slider.js"></script>
    <script type="text/javascript" src="../dist/intermix.js"></script>
  </head>
  <body>

    <div class="container row">
      <!-- <div class="nav col-md-4">
        <h3>Demos:</h3>
        <ul class="nav nav-pills nav-stacked">
          <li role="presentation" class="active"><a href="#">Sound</a></li>
          <li role="presentation"><a href="StepSequencer.html">Stepsequencer</a></li>
        </ul>
      </div> -->
      <div class="demo col-md-8">
        <!-- <h1>Sound</h1> -->
        <div class="panel panel-primary">
          <div class="panel-heading">
            The SoundWave object can load PCM data from audio files
            (.wav, .mp3, .ogg). It can also handle data from ArrayBuffer
            or AudioBuffer objects which gives you the freedom to load PCM data
            from virtually any source.<br>
            Multiple sources can be concatenated into one buffer.
            SoundWave objects can export any part of its buffer which
            makes it possible to slice buffers and reassemble them.
          </div>
          <div class="panel-body">
            <form>
              <p>

                You can load files from a webserver using the buildin loader:
              </p>
              <p>
                One file ('dxbass1.ogg'):
              </p>
              <input class="btn btn-default" type="button" value="Play" onclick="startSingle()"><br>
              <p>
                Three files ([ dxbass1.ogg', 'dxbass2.ogg', 'dxbass3.ogg' ]):
              </p>
              <input class="btn btn-default" type="button" value="Whole" onclick="startMulti()">
              <input class="btn btn-default" type="button" value="Fragment1" onclick="startMultiFrag(1)">
              <input class="btn btn-default" type="button" value="Fragment2" onclick="startMultiFrag(2)">
              <input class="btn btn-default" type="button" value="Fragment3" onclick="startMultiFrag(3)"><br>
              <p>
                If you want to use a custom loader, see the API docs for an example.
              </p>
            </form>
            <form class="" action="index.html" method="post">
              <p>
                You can load files from the filesystem (just one file to keep it simple):
              </p>
              <!-- <input type="file" id="file-input" accept=".touchosc" multiple style="display:none"></input> -->
              <input type="file" id="file-input" accept="audio/*" onchange="handleFiles(this.files)">
              <div id="sound3"></div>
            </form>
            <p>
              Working with fragments:
            </p>
            <form class="">
              <span>Another Soundwave with 4 fragments:</span>
              <input class="btn btn-default" type="button" value="Play" onclick="startSource()">
              <p>
                Create custom fragments ...
              </p>
              <input id="fragment1Range"
              data-slider-id="frag1Slider"
              type="text"
              data-slider-tooltip="hide"
              >
              <input class="btn btn-default btn-frag" type="button" value="Play" onclick="startCustomFrag(1)"><br>
              <input id="fragment2Range"
              data-slider-id="frag2Slider"
              type="text"
              data-slider-tooltip="hide"
              >
              <input class="btn btn-default btn-frag" type="button" value="Play" onclick="startCustomFrag(2)"><br>
              <input id="fragment3Range"
              data-slider-id="frag3Slider"
              type="text"
              data-slider-tooltip="hide"
              >
              <input class="btn btn-default btn-frag" type="button" value="Play" onclick="startCustomFrag(3)"><br>
              <input id="fragment4Range"
              data-slider-id="frag4Slider"
              type="text"
              data-slider-tooltip="hide"
              >
              <input class="btn btn-default btn-frag" type="button" value="Play" onclick="startCustomFrag(4)">
              <p>
                ... and reassemble them:
              </p>
              <input class="btn btn-default" type="button" value="Build new wave" onclick="buildCustomWave()">
              <input class="btn btn-default" type="button" value="Play" onclick="startCustomWave()">
            </form>

          </div>
          <div class="panel-footer">
            All sounds sampled from a <a target="_blank" href="http://www.vintagesynth.com/yamaha/dx7.php">Yamaha DX7</a>.
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">

      var frag1Slider, frag2Slider, frag3Slider, frag4Slider;

      /********************************
       * Loading one file from server
       */
      var soundWave1 = new intermix.SoundWave('assets/samples/DX7/dxbass1.ogg');
      var sound1 = new intermix.Sound(soundWave1);

      function startSingle() {
        sound1.start();
      }

      /**************************************
       * Loading multiple files from server
       */
      var files = [
        'assets/samples/DX7/dxbass1.ogg',
        'assets/samples/DX7/dxbass2.ogg',
        'assets/samples/DX7/dxbass3.ogg'
      ];
      var soundWave2 = new intermix.SoundWave(files);
      var sound2 = new intermix.Sound(soundWave2);

      function startMulti() {
        soundWave2.useWave(0);
        sound2.start();
      };

      function startMultiFrag(num) {
        soundWave2.useWave(num);
        sound2.start();
      };

      /****************************
       * Loading local files
       */
      var soundWave3, sound3;

      function handleFiles(files) {
        var file = files[0];
        if (typeof file !== 'undefined') {
          var fileReader = new FileReader();
          fileReader.onload = handleFileContent;
          fileReader.fname = file.name;
          fileReader.readAsArrayBuffer(file);
        }
      };

      function handleFileContent(evt) {
        var audio = evt.target.result;
        var fname = evt.target.fname;
        soundWave3 = new intermix.SoundWave(audio);
        sound3 = new intermix.Sound(soundWave3);
        createButton(fname);
      };

      function createButton(fname) {
        var buttons = '<input class="btn btn-default" type="button" value="Play: ' + fname + '" onclick="startSingle2()">';
        buttons += '<input class="btn btn-default" type="button" value="Stop: ' + fname + '" onclick="stopSingle2()">'
        var el = document.getElementById('sound3');
        el.innerHTML = buttons;
      };

      function startSingle2() {
        sound3.start();
      };

      function stopSingle2() {
        sound3.stop();
      };

      /********************************
       * Working with fragments
       */
      var files2 = [
        'assets/samples/DX7/thunder.ogg',
        'assets/samples/DX7/robot.ogg',
        'assets/samples/DX7/syngliss.ogg',
        'assets/samples/DX7/image.ogg'
      ];
      var soundWave4 = new intermix.SoundWave(files2);
      var sound4 = new intermix.Sound(soundWave4);
      var frags  = [
        { 'start': 0, 'end': 0 },
        { 'start': 0, 'end': 0 },
        { 'start': 0, 'end': 0 },
        { 'start': 0, 'end': 0 }
      ];
      var soundWave5, sound5;

      setTimeout(function() {
        var blength = soundWave4.buffer.length;
        frags = getFrags(soundWave4.metaData);

        frag1Slider = new Slider('#fragment1Range', {
          'min': 0,
          'max': blength,
          'step': 1,
          'value': [ frags[0].start, frags[0].end ]
        })
        .on('slide', function(e) {
          frags[0].start = Math.round(e[0]);
          frags[0].end = Math.round(e[1]);
        });
        frag2Slider = new Slider('#fragment2Range', {
          'min': 0,
          'max': blength,
          'step': 1,
          'value': [ frags[1].start, frags[1].end ]
        })
        .on('slide', function(e) {
          frags[1].start = Math.round(e[0]);
          frags[1].end = Math.round(e[1]);
        });
        frag3Slider = new Slider('#fragment3Range', {
          'min': 0,
          'max': blength,
          'step': 1,
          'value': [ frags[2].start, frags[2].end ]
        })
        .on('slide', function(e) {
          frags[2].start = Math.round(e[0]);
          frags[2].end = Math.round(e[1]);
        });
        frag4Slider = new Slider('#fragment4Range', {
          'min': 0,
          'max': blength,
          'step': 1,
          'value': [ frags[3].start, frags[3].end ]
        })
        .on('slide', function(e) {
          frags[3].start = Math.round(e[0]);
          frags[3].end = Math.round(e[1]);
        });
      }, 250);

      function getFrags(metaData) {
        var frags = [];
        metaData.forEach(function(meta) {
          frags.push({
            'start': meta.start,
            'end': meta.end
          });
        });
        return frags;
      };

      function startSource() {
        sound4.start();
      };

      function startCustomFrag(num) {
        var frag = soundWave4.getBufferFragment(frags[num - 1].start, frags[num - 1].end);
        var swTemp = new intermix.SoundWave(frag);
        var sTemp = new intermix.Sound(swTemp);
        sTemp.start();
      };

      function buildCustomWave() {
        var fragments = [];
        frags.forEach(function(frag) {
          var f = soundWave4.getBufferFragment(frag.start, frag.end);
          fragments.push(f);
        });
        soundWave5 = new intermix.SoundWave(fragments);
        sound5 = new intermix.Sound(soundWave5);
      };

      function startCustomWave() {
        sound5.start();
      };

    </script>
  </body>
</html>
