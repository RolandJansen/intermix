{"version":3,"sources":["d:/Users/jansen/git/intermix.js/node_modules/browser-pack/_prelude.js","src/main.js","d:/Users/jansen/git/intermix.js/src/core.js","d:/Users/jansen/git/intermix.js/src/Sequencer.js","d:/Users/jansen/git/intermix.js/src/Sound.js","d:/Users/jansen/git/intermix.js/src/SoundWave.js","d:/Users/jansen/git/intermix.js/src/Part.js","d:/Users/jansen/git/intermix.js/src/scheduleWorker.js","d:/Users/jansen/git/intermix.js/node_modules/webworkify/index.js"],"names":["Intermix","require","SoundWave","Sound","Sequencer","Part","module","exports","audioCtx","window","AudioContext","webkitAudioContext","work","self","this","beatsPerMinute","resolution","interval","lookahead","now","timePerStep","nextStepTime","queue","runQueue","nextStep","loop","loopStart","loopEnd","setTimePerStep","scheduleWorker","onmessage","e","data","scheduler","postMessage","message","prototype","currentTime","push","noteQueue","forEach","part","index","seqEvents","shift","seqEvent","note","sound","play","controller","length","splice","start","stop","addPart","position","createNoteEvent","bpm","soundBuffer","buffer","isPaused","gainNode","pannerNode","soundLength","startOffset","startTime","Error","duration","setupAudioChain","createGain","createStereoPanner","connect","destination","gain","value","console","log","createBufferSource","bufferSource","onended","destroyBufferSource","bsNode","disconnect","node","delay","playLooped","bs","paused","pause","setLoopStart","setLoopEnd","resetLoop","setFrequency","freq","playbackRate","getFrequency","setTone","semiTone","detune","getTone","getUID","Math","random","toString","substr","binaryData","collection","decodeAudioData","then","decoded","instrument","name","pattern","monophonic","zeroPoint","initPart","initPattern","i","addEvent","removeEvent","clearPattern","getLength","extendOnStart","extLength","entries","extension","apply","extendOnEnd","timer","setInterval","clearInterval","bundleFn","arguments","sources","cache","stringify","JSON","fn","wkey","cacheKeys","Object","keys","l","key","exp","floor","pow","wcache","Function","skey","scache","src","map","join","URL","webkitURL","mozURL","msURL","Worker","createObjectURL","Blob","type"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\r\n\r\n//Intermix = require('./core.js');\r\nvar Intermix = require('./core.js') || {};\r\nIntermix.SoundWave = require('./SoundWave.js');\r\nIntermix.Sound = require('./Sound.js');\r\nIntermix.Sequencer = require('./Sequencer.js');\r\nIntermix.Part = require('./Part.js');\r\n\r\nmodule.exports = Intermix;\r\n","/**\r\n * This simply creates the audio context objects\r\n * and exports it.\r\n *\r\n * TODO: - Should we do backwards-compatibility for older api-versions?\r\n *       - Check for mobile/iOS compatibility.\r\n *       - Check if we're running on node (and throw an error if so)\r\n */\r\n'use strict';\r\n\r\nvar audioCtx = null;\r\n\r\n(function() {\r\n\r\n  window.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\r\n  if (window.AudioContext) {\r\n    audioCtx = new window.AudioContext();\r\n  } else {\r\n    //TODO: throw error, probably surround with try/catch\r\n  }\r\n\r\n})();\r\n\r\nmodule.exports = {\r\n  audioCtx: audioCtx\r\n};\r\n","/**\r\n * Sequencer\r\n *\r\n * Scheduling inspired by \"A Tale of Two Clocks\" by Chris Wilson:\r\n * http://www.html5rocks.com/en/tutorials/audio/scheduling/\r\n */\r\n'use strict';\r\n\r\nvar work = require('webworkify');\r\n\r\nvar Sequencer = function(audioCtx) {\r\n\r\n  var self = this;\r\n  this.audioCtx = audioCtx;\r\n  this.beatsPerMinute = 120;  //beats per minute\r\n  this.resolution = 16;       //shortest possible note\r\n  this.interval = 100;        //the interval in miliseconds the scheduler gets invoked.\r\n  this.lookahead = 0.125;     //number of miliseconds the scheduler looks ahead.\r\n                              //should be longer than interval.\r\n  this.now;                    //timestamp from audiocontext when the scheduler is invoked.\r\n  this.timePerStep;           //period of time between two steps\r\n  this.nextStepTime = 0;      //time in seconds when the next step will be triggered\r\n  this.queue = [];            //List with all parts of the score\r\n  this.runQueue = [];         //list with parts that are playing or will be played shortly\r\n  this.nextStep = 0;          //position in the queue that will get triggered next\r\n  this.loop = false;          //play a section of the queue in a loop\r\n  this.loopStart;             //first step of the loop\r\n  this.loopEnd;               //last step of the loop\r\n\r\n  // set time per setTimePerStep\r\n  this.timePerStep = this.setTimePerStep(this.beatsPerMinute, this.resolution);\r\n\r\n  /*eslint-disable */\r\n\r\n  // Initialize the scheduler-timer\r\n  this.scheduleWorker = work(require('./scheduleWorker.js'));\r\n\r\n  /*eslint-enable */\r\n\r\n  this.scheduleWorker.onmessage = function(e) {\r\n    if (e.data === 'tick') {\r\n      self.scheduler();\r\n    }\r\n  };\r\n\r\n  this.scheduleWorker.postMessage({'message': this.interval});\r\n};\r\n\r\nSequencer.prototype.scheduler = function() {\r\n  this.now = this.audioCtx.currentTime;\r\n\r\n  if (this.nextStepTime === 0) {\r\n    this.nextStepTime = this.now;\r\n  }\r\n\r\n  while (this.nextStepTime < this.now + this.lookahead) {\r\n    if (this.queue[this.nextStep]) {\r\n      this.runQueue.push(this.noteQueue[this.nextStep]);\r\n    }\r\n\r\n    this.runQueue.forEach(function(part, index) {\r\n      var seqEvents = part.shift();  //return first element and remove it from part\r\n      if (seqEvents) {\r\n        seqEvents.forEach(function(seqEvent) {\r\n          if (seqEvent.note) {\r\n            seqEvent.sound.play(this.nextStepTime);\r\n          } else if (seqEvent.controller) {\r\n            // process controller event;\r\n          }\r\n\r\n          //remove part from runQueue if empty\r\n          if (part.length === 0) {\r\n            this.runQueue.splice(index, 1);\r\n          }\r\n        });\r\n      }\r\n\r\n    });\r\n\r\n    this.nextStepTime += this.timePerStep;\r\n\r\n    // set pointer to the next step in the queue that should be played.\r\n    // If we're playing in loop mode, jump back to loopstart when\r\n    // end of loop is reached.\r\n    if (this.loop) {\r\n      if (this.nextStep >= this.loopEnd) {\r\n        this.nextStep = this.loopStart;\r\n        this.runQueue = [];\r\n      } else {\r\n        this.nextStep++;\r\n      }\r\n    } else {\r\n      this.nextStep++;\r\n    }\r\n  }\r\n};\r\n\r\nSequencer.prototype.start = function() {\r\n  this.scheduleWorker.postMessage('start');\r\n};\r\n\r\nSequencer.prototype.stop = function() {\r\n  this.scheduleWorker.postMessage('stop');\r\n  this.runQueue = [];\r\n};\r\n\r\nSequencer.prototype.addPart = function(part, position) {\r\n  if (!this.queue[position]) {\r\n    this.queue[position] = [];\r\n  }\r\n  this.queue[position].push(part);\r\n};\r\n\r\nSequencer.prototype.createNoteEvent = function(note, length) {\r\n  return {\r\n    'note': note,\r\n    'length': length\r\n  };\r\n};\r\n\r\nSequencer.prototype.setTimePerStep = function(bpm, resolution) {\r\n  return (60 * 4) / (bpm * resolution);\r\n};\r\n\r\nmodule.exports = Sequencer;\r\n","'use strict';\r\n\r\nvar Sound = function(audioCtx, soundBuffer) {\r\n\r\n  this.audioCtx = null;\r\n  this.buffer = null;\r\n  this.queue = [];          //all currently active streams\r\n  this.loop = false;\r\n  this.isPaused = false;\r\n  this.gainNode = null;\r\n  this.pannerNode = null;\r\n\r\n  this.soundLength = 0;\r\n  this.startOffset = 0;\r\n  this.startTime = 0;\r\n  this.loopStart = 0;\r\n  this.loopEnd = null;\r\n\r\n  if (soundBuffer && audioCtx) {\r\n    this.audioCtx = audioCtx;\r\n    this.buffer = soundBuffer;\r\n    this.soundLength = this.loopEnd = soundBuffer.duration;\r\n    this.setupAudioChain();\r\n  } else {\r\n    throw new Error('Error initialising Sound object: parameter missing.');\r\n  }\r\n};\r\n\r\nSound.prototype.setupAudioChain = function() {\r\n  this.gainNode = this.audioCtx.createGain();\r\n  this.pannerNode = this.audioCtx.createStereoPanner();\r\n  this.gainNode.connect(this.pannerNode);\r\n  this.pannerNode.connect(this.audioCtx.destination);\r\n  this.gainNode.gain.value = 1;\r\n  console.log('audiochain ready');\r\n};\r\n\r\nSound.prototype.createBufferSource = function() {\r\n  var self = this;\r\n  var bufferSource = this.audioCtx.createBufferSource();\r\n  bufferSource.buffer = this.buffer;\r\n  bufferSource.connect(this.gainNode);\r\n  bufferSource.onended = function() {\r\n    console.log('onended fired');\r\n    self.destroyBufferSource(bufferSource);\r\n  };\r\n  return bufferSource;\r\n};\r\n\r\nSound.prototype.destroyBufferSource = function(bsNode) {\r\n  var self = this;\r\n  bsNode.disconnect();\r\n  this.queue.forEach(function(node, index) {\r\n    if (node === bsNode) {\r\n      self.queue.splice(index, 1);\r\n    }\r\n  });\r\n  bsNode = null; //probably futile\r\n  console.log('BufferSourceNode destroyed');\r\n  console.log('queue in queue: ' + this.queue.length);\r\n};\r\n\r\nSound.prototype.play = function(delay, playLooped) {\r\n  var startTime = 0;\r\n\r\n  if (delay) {\r\n    console.log('set start time: ' + delay);\r\n    startTime = delay;\r\n  } else {\r\n    startTime = this.audioCtx.currentTime;\r\n  }\r\n  var bs = this.createBufferSource();\r\n  bs.loop = playLooped;\r\n\r\n  // if (playLooped) {\r\n  //   bs.loopStart = this.loopStart;\r\n  //   bs.loopEnd = this.loopEnd;\r\n  // }\r\n\r\n  // if (this.startOffset === 0 || this.startOffset >= this.buffer.duration) {\r\n  //   console.log('resetting starttime');\r\n  //   this.startTime = this.audioCtx.currentTime;\r\n  // }\r\n  this.queue.push(bs);\r\n  //bs.start(startTime, this.startOffset);\r\n  bs.start(startTime);\r\n\r\n  this.startOffset = 0;\r\n};\r\n\r\nSound.prototype.stop = function(paused) {\r\n  if (paused) { //this has to be rewritten since there could be multiple start times.\r\n    this.startOffset = this.audioCtx.currentTime - this.startTime;\r\n    this.paused = false;\r\n  }\r\n  if (this.queue.length > 0) {\r\n    this.queue.forEach(function(node) {\r\n      node.stop();\r\n    });\r\n  } else {\r\n    //fail silently\r\n  }\r\n};\r\n\r\nSound.prototype.pause = function() {\r\n  this.isPaused = true;\r\n  this.stop(this.isPaused);\r\n};\r\n\r\nSound.prototype.setLoopStart = function(value) {\r\n  this.loopStart = value * this.soundLength;\r\n  this.bufferSource.loopStart = this.loopStart;\r\n};\r\n\r\nSound.prototype.setLoopEnd = function(value) {\r\n  this.loopEnd = value * this.soundLength;\r\n  this.bufferSource.loopEnd = this.loopEnd;\r\n};\r\n\r\nSound.prototype.resetLoop = function() {\r\n  this.loopStart = 0;\r\n  this.loopEnd = this.soundLength;\r\n};\r\n\r\nSound.prototype.setFrequency = function(freq) {\r\n  this.bufferSource.playbackRate.value = freq;\r\n};\r\n\r\nSound.prototype.getFrequency = function() {\r\n  return this.bufferSource.playbackRate.value;\r\n};\r\n\r\nSound.prototype.setTone = function(semiTone) {\r\n  this.bufferSource.detune.value = semiTone * 100;\r\n};\r\n\r\nSound.prototype.getTone = function() {\r\n  return this.bufferSource.detune.value;\r\n};\r\n\r\nSound.prototype.getUID = function() {\r\n  return Math.random().toString().substr(2, 8);\r\n};\r\n\r\nmodule.exports = Sound;\r\n","'use strict';\r\n\r\nvar SoundWave = function(audioCtx, binaryData, collection) {\r\n\r\n  this.audioCtx = null;\r\n  this.buffer = null;\r\n\r\n\r\n  if (audioCtx) {\r\n    this.audioCtx = audioCtx;\r\n  } else {\r\n    console.log('No AudioContext found');\r\n  }\r\n\r\n  var self = this;\r\n\r\n  if (binaryData) {\r\n    this.audioCtx.decodeAudioData(binaryData).then(function(decoded) {\r\n      self.buffer = decoded;\r\n      console.log('buffer created');\r\n    });\r\n  } else {\r\n    //TODO: throw error\r\n  }\r\n\r\n  if (collection) {\r\n    //TODO: put buffer into soundbank\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = SoundWave;\r\n","/**\r\n * Part.js\r\n */\r\n'use strict';\r\n\r\nvar Part = function(audioCtx, instrument) {\r\n  this.audioCtx;\r\n  this.instrument;\r\n  this.resolution = 16;\r\n  this.length = 1;      //1 = one bar (4 beats)\r\n  this.name = 'Part';\r\n  this.data;\r\n  this.pattern = [];\r\n  this.monophonic = false; //probably futile\r\n  this.zeroPoint = 0;\r\n\r\n  if (audioCtx && instrument) {\r\n    this.audioCtx = audioCtx;\r\n    this.instrument = instrument;\r\n    this.initPart();\r\n  } else {\r\n    throw new Error('Failed to initialize part. AudioCtx and/or instrument missing.');\r\n  }\r\n\r\n};\r\n\r\nPart.prototype.initPart = function() {\r\n  this.pattern = this.initPattern(this.length);\r\n  this.data = {\r\n    'name': this.name,\r\n    'instrument': this.instrument,\r\n    'resolution': this.resolution,\r\n    'pattern': this.pattern\r\n  };\r\n};\r\n\r\n/**\r\n * initPattern: Initialize an empty pattern in this part\r\n * @param  {Float}  length  Length of the pattern mesured in bars\r\n * @return {Object} The current context to make the function chainable.\r\n */\r\nPart.prototype.initPattern = function(length) {\r\n  var pattern = [];\r\n  for (var i = 0; i < (length * 64); i++) {\r\n    pattern[i] = [];\r\n  }\r\n  return pattern;\r\n};\r\n\r\n/**\r\n * addEvent: adds an event to the pattern at a given position\r\n * @param  {Object} seqEvent  The event (note or controller)\r\n * @param  {Int}    position  Position in the pattern\r\n * @return {Object} The current context to make the function chainable.\r\n */\r\nPart.prototype.addEvent = function(seqEvent, position) {\r\n  this.pattern[position].push(seqEvent);\r\n  return this;\r\n};\r\n\r\nPart.prototype.removeEvent = function() {\r\n\r\n};\r\n\r\n/**\r\n * clearPattern: Delete all events in this part\r\n * @return {Object} The current context to make the function chainable.\r\n */\r\nPart.prototype.clearPattern = function() {\r\n  this.pattern = [];\r\n  return this;\r\n};\r\n\r\nPart.prototype.getLength = function() {\r\n  return this.pattern.length;\r\n};\r\n\r\nPart.prototype.extendOnStart = function(pattern, extLength) {\r\n  var entries = extLength * 64;\r\n  var extension = this.initPattern(entries);\r\n  return pattern.push.apply(extension, pattern);\r\n};\r\n\r\nPart.prototype.extendOnEnd = function(pattern, extLength) {\r\n  var entries = extLength * 64;\r\n  var extension = this.initPattern(entries);\r\n  return pattern.push.apply(pattern, extension);\r\n};\r\n\r\nmodule.exports = Part;\r\n","/**\r\n * This is a webworker that provides a timer\r\n * that fires the scheduler for the sequencer.\r\n * This is because timing here is much smoother\r\n * than in the main thread.\r\n */\r\n'use strict';\r\n\r\nvar timer = null;\r\nvar interval = 100;\r\n\r\n/*eslint-disable */\r\nself.onmessage = function(e) {\r\n  if (e.data === 'start') {\r\n    timer = setInterval(function() {postMessage('tick');}, interval);\r\n  } else if (e.data === 'stop') {\r\n    clearInterval(timer);\r\n  } else if (e.data.interval) {\r\n    interval = e.data.interval;\r\n    if (timer) {\r\n      clearInterval(timer);\r\n      timer = setInterval(function() {postMessage('tick');}, interval);\r\n    }\r\n  }\r\n};\r\n\r\npostMessage('A-Ok', '*');\r\n","var bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn) {\n    var keys = [];\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            Function(['require','module','exports'], '(' + fn + ')(self)'),\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        Function(['require'], (\n            // try to call default if defined to also support babel esmodule\n            // exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);'\n        )),\n        scache\n    ];\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(sources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    return new Worker(URL.createObjectURL(\n        new Blob([src], { type: 'text/javascript' })\n    ));\n};\n"]}