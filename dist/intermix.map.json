{"version":3,"sources":["d:/Users/jansen/git/intermix.js/node_modules/browser-pack/_prelude.js","src/main.js","d:/Users/jansen/git/intermix.js/src/core.js","d:/Users/jansen/git/intermix.js/src/SoundWave.js","d:/Users/jansen/git/intermix.js/src/Sound.js"],"names":["Intermix","require","SoundWave","Sound","module","exports","audioCtx","window","AudioContext","webkitAudioContext","binaryData","collection","this","buffer","console","log","self","decodeAudioData","then","decoded","soundBuffer","bufferSource","loop","isPaused","gainNode","pannerNode","soundLength","startOffset","startTime","loopStart","loopEnd","Error","duration","setupAudioChain","prototype","createGain","createStereoPanner","connect","destination","gain","value","createBufferSource","onended","destroyBufferSource","disconnect","play","time","currentTime","start","stop","paused","pause","setLoopStart","setLoopEnd","resetLoop","setFrequency","freq","playbackRate","getFrequency","setTone","semiTone","detune","getTone","getUID","Math","random","toString","substr"],"mappings":"AAAA;ACAA,YAGA,IAAIA,UAAWC,QAAQ,gBACvBD,UAASE,UAAYD,QAAQ,kBAC7BD,SAASG,MAAQF,QAAQ,cAEzBG,OAAOC,QAAUL;;AGPjB,YAEA,IAAIG,OAAQ,SAASG,EAAUc,GAgB7B,GAdAR,KAAKN,SAAW,KAChBM,KAAKC,OAAS,KACdD,KAAKS,aAAe,KACpBT,KAAKU,MAAO,EACZV,KAAKW,UAAW,EAChBX,KAAKY,SAAW,KAChBZ,KAAKa,WAAa,KAElBb,KAAKc,YAAc,EACnBd,KAAKe,YAAc,EACnBf,KAAKgB,UAAY,EACjBhB,KAAKiB,UAAY,EACjBjB,KAAKkB,QAAU,MAEXV,IAAed,EAMjB,KAAM,IAAIyB,OAAM,sDALhBnB,MAAKN,SAAWA,EAChBM,KAAKC,OAASO,EACdR,KAAKc,YAAcd,KAAKkB,QAAUV,EAAYY,SAC9CpB,KAAKqB,kBAMT9B,OAAM+B,UAAUD,gBAAkB,WAChCrB,KAAKY,SAAWZ,KAAKN,SAAS6B,aAC9BvB,KAAKa,WAAab,KAAKN,SAAS8B,qBAChCxB,KAAKY,SAASa,QAAQzB,KAAKa,YAC3Bb,KAAKa,WAAWY,QAAQzB,KAAKN,SAASgC,aACtC1B,KAAKY,SAASe,KAAKC,MAAQ,EAC3B1B,QAAQC,IAAI,qBAGdZ,MAAM+B,UAAUO,mBAAqB,WACnC,GAAIzB,GAAOJ,IACXA,MAAKS,aAAeT,KAAKN,SAASmC,qBAClC7B,KAAKS,aAAaR,OAASD,KAAKC,OAChCD,KAAKS,aAAagB,QAAQzB,KAAKY,UAC/BZ,KAAKS,aAAaqB,QAAU,WAC1B5B,QAAQC,IAAI,iBACZC,EAAK2B,wBAITxC,MAAM+B,UAAUS,oBAAsB,WACV,OAAtB/B,KAAKS,eACPT,KAAKS,aAAauB,aAClBhC,KAAKS,aAAe,KACpBP,QAAQC,IAAI,gCAIhBZ,MAAM+B,UAAUW,KAAO,SAASvB,EAAMwB,GAChB,mBAATxB,KACTV,KAAKU,KAAOA,GAGVwB,GACFhC,QAAQC,IAAI,aAAe+B,GAC3BlC,KAAKgB,UAAYkB,GAEjBlC,KAAKgB,UAAYhB,KAAKN,SAASyC,YAGjCnC,KAAK6B,qBACL7B,KAAKS,aAAaC,KAAOV,KAAKU,KAE1BV,KAAKU,OACPV,KAAKS,aAAaQ,UAAYjB,KAAKiB,UACnCjB,KAAKS,aAAaS,QAAUlB,KAAKkB,SAQnClB,KAAKS,aAAa2B,MAAMpC,KAAKgB,UAAWhB,KAAKe,aAC7Cf,KAAKe,YAAc,GAGrBxB,MAAM+B,UAAUe,KAAO,SAASC,GAC1BA,IACFtC,KAAKe,YAAcf,KAAKN,SAASyC,YAAcnC,KAAKgB,UACpDhB,KAAKsC,QAAS,GAEU,OAAtBtC,KAAKS,cACPT,KAAKS,aAAa4B,QAMtB9C,MAAM+B,UAAUiB,MAAQ,WACtBvC,KAAKW,UAAW,EAChBX,KAAKqC,KAAKrC,KAAKW,WAGjBpB,MAAM+B,UAAUkB,aAAe,SAASZ,GACtC5B,KAAKiB,UAAYW,EAAQ5B,KAAKc,YAC9Bd,KAAKS,aAAaQ,UAAYjB,KAAKiB,WAGrC1B,MAAM+B,UAAUmB,WAAa,SAASb,GACpC5B,KAAKkB,QAAUU,EAAQ5B,KAAKc,YAC5Bd,KAAKS,aAAaS,QAAUlB,KAAKkB,SAGnC3B,MAAM+B,UAAUoB,UAAY,WAC1B1C,KAAKiB,UAAY,EACjBjB,KAAKkB,QAAUlB,KAAKc,aAGtBvB,MAAM+B,UAAUqB,aAAe,SAASC,GACtC5C,KAAKS,aAAaoC,aAAajB,MAAQgB,GAGzCrD,MAAM+B,UAAUwB,aAAe,WAC7B,MAAO9C,MAAKS,aAAaoC,aAAajB,OAGxCrC,MAAM+B,UAAUyB,QAAU,SAASC,GACjChD,KAAKS,aAAawC,OAAOrB,MAAmB,IAAXoB,GAGnCzD,MAAM+B,UAAU4B,QAAU,WACxB,MAAOlD,MAAKS,aAAawC,OAAOrB,OAGlCrC,MAAM+B,UAAU6B,OAAS,WACvB,MAAOC,MAAKC,SAASC,WAAWC,OAAO,EAAG,IAG5C/D,OAAOC,QAAUF;;ADzIjB,YAEA,IAAID,WAAY,SAASI,EAAUI,EAAYC,GAE7CC,KAAKN,SAAW,KAChBM,KAAKC,OAAS,KAGVP,EACFM,KAAKN,SAAWA,EAEhBQ,QAAQC,IAAI,wBAGd,IAAIC,GAAOJ,IAEPF,IACFE,KAAKN,SAASW,gBAAgBP,GAAYQ,KAAK,SAASC,GACtDH,EAAKH,OAASM,EACdL,QAAQC,IAAI,oBAYlBX,QAAOC,QAAUH;;ADvBjB,YAEA,IAAII,UAAW,MAEf,WAEEC,OAAOC,aAAeD,OAAOC,cAAgBD,OAAOE,mBAEhDF,OAAOC,eACTF,SAAW,GAAIC,QAAOC,iBAO1BJ,OAAOC,SACLC,SAAUA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\r\n\r\n//Intermix = require('./core.js');\r\nvar Intermix = require('./core.js') || {};\r\nIntermix.SoundWave = require('./SoundWave.js');\r\nIntermix.Sound = require('./Sound.js');\r\n\r\nmodule.exports = Intermix;\r\n","/**\r\n * This simply creates the audio context objects\r\n * and exports it.\r\n *\r\n * TODO: - Should we do backwards-compatibility for older api-versions?\r\n *       - Check for mobile/iOS compatibility.\r\n *       - Check if we're running on node (and throw an error if so)\r\n */\r\n'use strict';\r\n\r\nvar audioCtx = null;\r\n\r\n(function() {\r\n\r\n  window.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\r\n  if (window.AudioContext) {\r\n    audioCtx = new window.AudioContext();\r\n  } else {\r\n    //TODO: throw error, probably surround with try/catch\r\n  }\r\n\r\n})();\r\n\r\nmodule.exports = {\r\n  audioCtx: audioCtx\r\n};\r\n","'use strict';\r\n\r\nvar SoundWave = function(audioCtx, binaryData, collection) {\r\n\r\n  this.audioCtx = null;\r\n  this.buffer = null;\r\n\r\n\r\n  if (audioCtx) {\r\n    this.audioCtx = audioCtx;\r\n  } else {\r\n    console.log('No AudioContext found');\r\n  }\r\n\r\n  var self = this;\r\n\r\n  if (binaryData) {\r\n    this.audioCtx.decodeAudioData(binaryData).then(function(decoded) {\r\n      self.buffer = decoded;\r\n      console.log('buffer created');\r\n    });\r\n  } else {\r\n    //TODO: throw error\r\n  }\r\n\r\n  if (collection) {\r\n    //TODO: put buffer into soundbank\r\n  }\r\n\r\n};\r\n\r\nmodule.exports = SoundWave;\r\n","'use strict';\r\n\r\nvar Sound = function(audioCtx, soundBuffer) {\r\n\r\n  this.audioCtx = null;\r\n  this.buffer = null;\r\n  this.bufferSource = null;\r\n  this.loop = false;\r\n  this.isPaused = false;\r\n  this.gainNode = null;\r\n  this.pannerNode = null;\r\n\r\n  this.soundLength = 0;\r\n  this.startOffset = 0;\r\n  this.startTime = 0;\r\n  this.loopStart = 0;\r\n  this.loopEnd = null;\r\n\r\n  if (soundBuffer && audioCtx) {\r\n    this.audioCtx = audioCtx;\r\n    this.buffer = soundBuffer;\r\n    this.soundLength = this.loopEnd = soundBuffer.duration;\r\n    this.setupAudioChain();\r\n  } else {\r\n    throw new Error('Error initialising Sound object: parameter missing.');\r\n  }\r\n};\r\n\r\nSound.prototype.setupAudioChain = function() {\r\n  this.gainNode = this.audioCtx.createGain();\r\n  this.pannerNode = this.audioCtx.createStereoPanner();\r\n  this.gainNode.connect(this.pannerNode);\r\n  this.pannerNode.connect(this.audioCtx.destination);\r\n  this.gainNode.gain.value = 1;\r\n  console.log('audiochain ready');\r\n};\r\n\r\nSound.prototype.createBufferSource = function() {\r\n  var self = this;\r\n  this.bufferSource = this.audioCtx.createBufferSource();\r\n  this.bufferSource.buffer = this.buffer;\r\n  this.bufferSource.connect(this.gainNode);\r\n  this.bufferSource.onended = function() {\r\n    console.log('onended fired');\r\n    self.destroyBufferSource();\r\n  };\r\n};\r\n\r\nSound.prototype.destroyBufferSource = function() {\r\n  if (this.bufferSource !== null) {\r\n    this.bufferSource.disconnect();\r\n    this.bufferSource = null;\r\n    console.log('BufferSourceNode destroyed');\r\n  }\r\n};\r\n\r\nSound.prototype.play = function(loop, time) {\r\n  if (typeof loop !== 'undefined') {\r\n    this.loop = loop;\r\n  }\r\n\r\n  if (time) {\r\n    console.log('set time: ' + time);\r\n    this.startTime = time;\r\n  } else {\r\n    this.startTime = this.audioCtx.currentTime;\r\n  }\r\n\r\n  this.createBufferSource();\r\n  this.bufferSource.loop = this.loop;\r\n\r\n  if (this.loop) {\r\n    this.bufferSource.loopStart = this.loopStart;\r\n    this.bufferSource.loopEnd = this.loopEnd;\r\n  }\r\n\r\n  // if (this.startOffset === 0 || this.startOffset >= this.buffer.duration) {\r\n  //   console.log('resetting starttime');\r\n  //   this.startTime = this.audioCtx.currentTime;\r\n  // }\r\n\r\n  this.bufferSource.start(this.startTime, this.startOffset);\r\n  this.startOffset = 0;\r\n};\r\n\r\nSound.prototype.stop = function(paused) {\r\n  if (paused) {\r\n    this.startOffset = this.audioCtx.currentTime - this.startTime;\r\n    this.paused = false;\r\n  }\r\n  if (this.bufferSource !== null) {\r\n    this.bufferSource.stop();\r\n  } else {\r\n    //fail silently\r\n  }\r\n};\r\n\r\nSound.prototype.pause = function() {\r\n  this.isPaused = true;\r\n  this.stop(this.isPaused);\r\n};\r\n\r\nSound.prototype.setLoopStart = function(value) {\r\n  this.loopStart = value * this.soundLength;\r\n  this.bufferSource.loopStart = this.loopStart;\r\n};\r\n\r\nSound.prototype.setLoopEnd = function(value) {\r\n  this.loopEnd = value * this.soundLength;\r\n  this.bufferSource.loopEnd = this.loopEnd;\r\n};\r\n\r\nSound.prototype.resetLoop = function() {\r\n  this.loopStart = 0;\r\n  this.loopEnd = this.soundLength;\r\n};\r\n\r\nSound.prototype.setFrequency = function(freq) {\r\n  this.bufferSource.playbackRate.value = freq;\r\n};\r\n\r\nSound.prototype.getFrequency = function() {\r\n  return this.bufferSource.playbackRate.value;\r\n};\r\n\r\nSound.prototype.setTone = function(semiTone) {\r\n  this.bufferSource.detune.value = semiTone * 100;\r\n};\r\n\r\nSound.prototype.getTone = function() {\r\n  return this.bufferSource.detune.value;\r\n};\r\n\r\nSound.prototype.getUID = function() {\r\n  return Math.random().toString().substr(2, 8);\r\n};\r\n\r\nmodule.exports = Sound;\r\n"]}