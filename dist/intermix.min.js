(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
"use strict";var intermix=_dereq_("./core.js")||{};intermix.events=_dereq_("./events.js"),intermix.SoundWave=_dereq_("./SoundWave.js"),intermix.Sound=_dereq_("./Sound.js"),intermix.Sequencer=_dereq_("./Sequencer.js"),intermix.Part=_dereq_("./Part.js"),module.exports=intermix;
},{"./Part.js":3,"./Sequencer.js":4,"./Sound.js":5,"./SoundWave.js":6,"./core.js":7,"./events.js":8}],2:[function(_dereq_,module,exports){
var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(r){for(var e,t=Object.keys(cache),n=0,o=t.length;o>n;n++){var a=t[n],i=cache[a].exports;if(i===r||i["default"]===r){e=a;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var s={},n=0,o=t.length;o>n;n++){var a=t[n];s[a]=a}sources[e]=[Function(["require","module","exports"],"("+r+")(self)"),s]}var u=Math.floor(Math.pow(16,8)*Math.random()).toString(16),f={};f[e]=e,sources[u]=[Function(["require"],"var f = require("+stringify(e)+");(f.default ? f.default : f)(self);"),f];var c="("+bundleFn+")({"+Object.keys(sources).map(function(r){return stringify(r)+":["+sources[r][0]+","+stringify(sources[r][1])+"]"}).join(",")+"},{},["+stringify(u)+"])",l=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(l.createObjectURL(new Blob([c],{type:"text/javascript"})))};
},{}],3:[function(_dereq_,module,exports){
"use strict";var Part=function(t){this.resolution=16,this.multiply=4,this.length=64,this.name="Part",this.pattern=[],t&&(this.length=t),this.pattern=this.initPattern(this.length)};Part.prototype.initPattern=function(t){for(var n=[],r=0;t>r;r++)n[r]=[];return n},Part.prototype.addEvent=function(t,n){if(!(n<=this.resolution))throw new Error("Position out of pattern bounds.");var r=n*this.multiply;return this.pattern[r].push(t),this},Part.prototype.removeEvent=function(t,n){var r=n*this.multiply,i=this.pattern[r].indexOf(t);this.pattern[r].splice(i,1)},Part.prototype.getLength=function(){return this.pattern.length},Part.prototype.getNotePositions=function(){var t=[];return this.pattern.forEach(function(n,r){n.length>0&&t.push(r/this.multiply)},this),t},Part.prototype.extendOnTop=function(t){var n=this.initPattern(t);this.pattern=n.concat(this.pattern)},Part.prototype.extendOnEnd=function(t){var n=this.initPattern(t);this.pattern=this.pattern.concat(n)},module.exports=Part;
},{}],4:[function(_dereq_,module,exports){
"use strict";var work=_dereq_("webworkify"),core=_dereq_("./core.js"),worker=_dereq_("./scheduleWorker.js"),Sequencer=function(){var e=this;this.ac=core,this.bpm=120,this.resolution=64,this.interval=100,this.lookahead=.3,this.queue=[],this.runqueue=[],this.timePerStep,this.nextStepTime=0,this.nextStep=0,this.lastPlayedStep=0,this.loop=!1,this.loopStart,this.loopEnd,this.isRunning=!1,this.animationFrame,this.timePerStep=this.setTimePerStep(this.bpm,this.resolution),this.scheduleWorker=work(worker),this.scheduleWorker.onmessage=function(t){"tick"===t.data&&e.scheduler()},this.scheduleWorker.postMessage({interval:this.interval})};Sequencer.prototype.scheduler=function(){var e=core.currentTime+this.lookahead;for(0===this.nextStepTime&&(this.nextStepTime=core.currentTime);this.nextStepTime<e;)this.addPartsToRunqueue(),this.fireEvents(),this.nextStepTime+=this.timePerStep,this.setQueuePointer()},Sequencer.prototype.addPartsToRunqueue=function(){if("undefined"!=typeof this.queue[this.nextStep])if(1===this.queue[this.nextStep].length){var e=this.queue[this.nextStep][0];e.pointer=0,this.runqueue.push(e)}else this.queue[this.nextStep].forEach(function(e){e.pointer=0,this.runqueue.push(e)},this)},Sequencer.prototype.deletePartsFromRunqueue=function(e){e.length>0&&e.forEach(function(e){delete this.runqueue[e].pointer,this.runqueue.splice(e,1)},this)},Sequencer.prototype.fireEvents=function(){var e=[];this.runqueue.forEach(function(t,i){if(t.pointer===t.length-1)e.unshift(i);else{var n=t.pattern[t.pointer];n&&n.length>1?n.forEach(function(e){this.processSeqEvent(e,this.nextStepTime)},this):n&&1===n.length&&this.processSeqEvent(n[0],this.nextStepTime)}t.pointer++},this),this.deletePartsFromRunqueue(e)},Sequencer.prototype.processSeqEvent=function(e,t){t&&(e.props.delay=t),e.props.instrument.processSeqEvent(e)},Sequencer.prototype.setQueuePointer=function(e){"undefined"!=typeof e?(this.nextStep=e,this.runqueue=[]):this.loop&&this.nextStep>=this.loopEnd?(this.nextStep=this.loopStart,this.runqueue=[]):this.nextStep++},Sequencer.prototype.resetQueuePointer=function(){this.setQueuePointer(0)},Sequencer.prototype.start=function(){this.isRunning||(this.scheduleWorker.postMessage("start"),this.isRunning=!0,window.requestAnimationFrame(this.draw.bind(this)))},Sequencer.prototype.stop=function(){this.scheduleWorker.postMessage("stop"),this.nextStepTime=0,this.isRunning=!1},Sequencer.prototype.pause=function(){return"running"===core.state&&this.isRunning?(this.stop(),core.suspend(),!0):!1},Sequencer.prototype.resume=function(){return"suspended"!==core.state||this.isRunning?!1:(this.start(),core.resume(),!0)},Sequencer.prototype.draw=function(){var e=this.nextStepTime-core.currentTime;if(e>=0){var t=Math.round(e/this.timePerStep);this.nextStep<t?this.lastPlayedStep=this.loopEnd+this.nextStep-t:this.lastPlayedStep=this.nextStep-t,this.updateFrame(this.lastPlayedStep)}this.isRunning&&window.requestAnimationFrame(this.draw.bind(this))},Sequencer.prototype.updateFrame=function(e){console.log(e)},Sequencer.prototype.addPart=function(e,t){if(!e.length||!e.pattern)throw new Error("Given parameter doesn't seem to be a part object");this.queue[t]||(this.queue[t]=[]),this.queue[t].push(e)},Sequencer.prototype.removePart=function(e,t){if(!(this.queue[t]instanceof Array&&this.queue[t].length>0))throw new Error("Part not found at position "+t+".");var i=this.queue[t].indexOf(e);this.queue[t].splice(i,1)},Sequencer.prototype.setBpm=function(e){this.bpm=e,this.timePerStep=this.setTimePerStep(e,this.resolution)},Sequencer.prototype.setTimePerStep=function(e,t){return 240/(e*t)},Sequencer.prototype.getLastPlayedStep=function(){},Sequencer.prototype.copyArray=function(e){for(var t=new Array(e.length),i=e.length;i--;)t[i]=e[i];return t},module.exports=Sequencer;
},{"./core.js":7,"./scheduleWorker.js":9,"webworkify":2}],5:[function(_dereq_,module,exports){
"use strict";var core=_dereq_("./core.js"),Sound=function(t){if(this.wave=null,this.ac=core,this.queue=[],this.loop=!1,this.gainNode=null,this.pannerNode=null,this.soundLength=0,this.isPaused=!1,this.startOffset=0,this.startOffsets=[],this.startTime=0,this.loopStart=0,this.loopEnd=null,this.playbackRate=1,this.detune=0,!t)throw new Error("Error initialising Sound object: parameter missing.");this.wave=t,this.soundLength=this.loopEnd=this.wave.buffer.duration,this.setupAudioChain()};Sound.prototype.setupAudioChain=function(){this.gainNode=core.createGain(),this.pannerNode=core.createStereoPanner(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(core.destination),this.gainNode.gain.value=1},Sound.prototype.createBufferSource=function(){var t=this,e=core.createBufferSource();return e.buffer=this.wave.buffer,e.connect(this.gainNode),e.onended=function(){t.destroyBufferSource(e)},e},Sound.prototype.destroyBufferSource=function(t){t.disconnect(),this.queue.forEach(function(e,o){e===t&&this.queue.splice(o,1)},this)},Sound.prototype.start=function(t,e,o){if(this.isPaused&&this.queue.length>0)this.resume();else{var n=0;n=e?e:core.currentTime;var u=this.createBufferSource();t&&(u.loop=t,u.loopStart=this.loopStart,u.loopEnd=this.loopEnd),u.playbackRate.value=u.tmpPlaybackRate=this.playbackRate,u.detune.value=this.detune,u.startTime=n,this.queue.push(u),o?u.start(n,this.startOffset,o):u.start(n,this.startOffset),this.startOffset=0}},Sound.prototype.stop=function(){this.queue.forEach(function(t){t.stop(),t.disconnect()}),this.queue=[]},Sound.prototype.pause=function(){this.isPaused||(this.queue.forEach(function(t){t.tmpPlaybackRate=t.playbackRate.value,t.playbackRate.value=0}),this.isPaused=!0)},Sound.prototype.resume=function(){this.queue.forEach(function(t){t.playbackRate.value=t.tmpPlaybackRate,delete t.tmpPlaybackRate}),this.isPaused=!1},Sound.prototype.processSeqEvent=function(t){t.props.duration?this.start(!1,t.props.delay,t.props.duration):this.start(!1,t.props.delay)},Sound.prototype.setLoopStart=function(t){this.loopStart=t,this.queue.forEach(function(e){e.loopStart=t})},Sound.prototype.setLoopEnd=function(t){this.loopEnd=t,this.queue.forEach(function(e){e.loopEnd=t})},Sound.prototype.releaseLoop=function(){this.queue.forEach(function(t){t.loop=!1})},Sound.prototype.resetLoop=function(){this.loopStart=0,this.loopEnd=this.soundLength},Sound.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.queue.forEach(function(e){e.playbackRate.value=t})},Sound.prototype.getPlaybackRate=function(){return this.playbackRate},Sound.prototype.setTone=function(t){if(!(t>=-12&&12>=t))throw new Error("Semi tone is "+t+". Must be between +/-12.");this.detune=100*t},Sound.prototype.getTone=function(){return this.detune/100},Sound.prototype.setDetune=function(t){if(!(t>=-1200&&1200>=t))throw new Error("Detune parameter is "+t+". Must be between +/-1200.");this.detune=t},Sound.prototype.getDetune=function(){return this.detune},Sound.prototype.getUID=function(){return Math.random().toString().substr(2,8)},module.exports=Sound;
},{"./core.js":7}],6:[function(_dereq_,module,exports){
"use strict";var core=_dereq_("./core.js"),SoundWave=function(e){var t=this;if(this.ac=core,this.buffer=core.createBuffer(1,0,core.sampleRate),this.metaData=[],"undefined"!=typeof e)if("string"==typeof e)this.buffer=this.loadFile(e).then(function(e){return t.decodeAudioData(e)}).then(function(e){return t.buffer=e,t.buffer})["catch"](function(e){throw e});else if(e instanceof Array&&"string"==typeof e[0])this.buffer=this.loadMultipleFiles(e).then(function(e){t.buffer=e})["catch"](function(e){throw e});else if(e instanceof ArrayBuffer)this.buffer=this.decodeAudioData(e);else{if(!(e instanceof Array&&e[0]instanceof ArrayBuffer))throw new Error("Cannot create SoundWave object: Unsupported data format");this.decodeAudioSources(e).then(function(e){return t.joinAudioBuffers(e)}).then(function(e){this.buffer=e})}};SoundWave.prototype.loadMultipleFiles=function(e){var t=this,n=this.stripFilenames(e);return this.loadFiles(e).then(function(e){return t.decodeAudioSources(e)}).then(function(e){var o=[];return o.push(t.joinAudioBuffers(e),t.storeMetaData(e,n)),Promise.all(o)}).then(function(e){return t.metaData=e[1],e[0]})["catch"](function(e){throw e})},SoundWave.prototype.decodeAudioSources=function(e){var t=[];return e.forEach(function(e){t.push(this.decodeAudioData(e))},this),Promise.all(t)},SoundWave.prototype.decodeAudioData=function(e){return core.decodeAudioData(e)},SoundWave.prototype.joinAudioBuffers=function(e){var t=this,n=core.createBuffer(1,0,core.sampleRate);return new Promise(function(o,r){e.forEach(function(e){e instanceof window.AudioBuffer?n=this.appendAudioBuffer(n,e):r(new TypeError("One or more buffers are not of type AudioBuffer."))},t),o(n)})},SoundWave.prototype.appendAudioBuffer=function(e,t){if(e instanceof window.AudioBuffer&&t instanceof window.AudioBuffer){for(var n=Math.min(e.numberOfChannels,t.numberOfChannels),o=core.createBuffer(n,e.length+t.length,e.sampleRate),r=0;n>r;r++){var u=o.getChannelData(r);u.set(e.getChannelData(r),0),u.set(t.getChannelData(r),e.length)}return o}throw new TypeError("One or both buffers are not of type AudioBuffer.")},SoundWave.prototype.storeMetaData=function(e,t){var n=[],o=[],r=0,u=this;return new Promise(function(f,i){"undefined"==typeof t?e.forEach(function(e,t){n.push("fragment"+t)}):t.length===e.length?n=t:i(new Error("audioBuffers and names should be of same length")),e.forEach(function(e,n){o.push(this.getMetaData(e,t[n],r)),r+=e.length},u),f(o)})},SoundWave.prototype.stripFilenames=function(e){return e.map(function(e){return e.split("/").pop()})},SoundWave.prototype.getMetaData=function(e,t,n){if(e instanceof window.AudioBuffer&&"string"==typeof t){"undefined"==typeof n&&(n=0);var o=e.length;return{name:t,start:n,end:n+o-1,length:o}}throw new TypeError("Arguments should be of type AudioBuffer and String")},SoundWave.prototype.loadFile=function(e){return window.fetch(e).then(function(t){if(t.ok)return t.arrayBuffer();throw new Error("Server error. Couldn't load file: "+e)})},SoundWave.prototype.loadFiles=function(e){var t=[];return e.forEach(function(e){t.push(this.loadFile(e))},this),Promise.all(t)},SoundWave.prototype.sortBinBuffers=function(e,t){return e.map(function(e){return t[e]})},module.exports=SoundWave;
},{"./core.js":7}],7:[function(_dereq_,module,exports){
"use strict";var audioCtx=null,isMobile={Android:function(){return window.navigator.userAgent.match(/Android/i)},iOS:function(){return window.navigator.userAgent.match(/iPhone|iPad|iPod/i)},BlackBerry:function(){return window.navigator.userAgent.match(/BlackBerry/i)},Opera:function(){return window.navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return window.navigator.userAgent.match(/IEMobile/i)||window.navigator.userAgent.match(/WPDesktop/i)},any:function(){return isMobile.Android()||isMobile.iOS()||isMobile.BlackBerry()||isMobile.Opera()||isMobile.Windows()}};!function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,"undefined"==typeof window.AudioContext)throw new Error("Couldn't initialize the audio context.");audioCtx=new window.AudioContext}(),module.exports=audioCtx;
},{}],8:[function(_dereq_,module,exports){
"use strict";var evProp=["instrument","tone","duration","velocity","pitch","volume","pan"],evType={note:[evProp[0],evProp[1],evProp[2],evProp[3]],control:[evProp[4],evProp[5],evProp[6]]},evClass={audio:[evType.note,evType.control],synth:[evType.note,evType.control],fx:[],midi:[],osc:[]},validateClass=function(e){return evClass.hasOwnProperty(e)?!0:!1},validateType=function(e){return evType.hasOwnProperty(e)?!0:!1},validatePropInstrument=function(e){return"object"==typeof e?!0:!1},validatePropToneVelo=function(e){return!isNaN(e)&&Number.isInteger(e)&&e>=0&&127>=e?!0:!1},validatePropDuration=function(e){return!isNaN(e)&&Number.isInteger(e)&&e>=0?!0:!1},validateProps=function(e,r){var t=evType[r];for(var o in e)if(-1===evProp.indexOf(o)&&-1===t.indexOf(o))return!1;return!0},convertTone=function(e){var r=["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"],t=e.toLowerCase();if(t.match(/^[a-h]#?[0-9]$/)){var o=t.substring(0,t.length-1),n=t.slice(-1);return"h"===o&&(o="b"),r.indexOf(o)+12*n}throw new Error("Unvalid string. Has to be like [a-h]<#>[0-9]")},createEvent=function(e,r,t){if(validateClass(e)&&validateType(r)&&validateProps(t,r))return{"class":e,type:r,props:t};throw new Error("Unable to create sequencer event. Wrong parameters")},createAudioNote=function(e,r,t,o){var n={};if("string"==typeof e&&(e=convertTone(e)),e&&validatePropToneVelo(e)&&(n.tone=e),r&&validatePropToneVelo(r)&&(n.velocity=r),t&&validatePropDuration(t)&&(n.duration=t),!o||!validatePropInstrument(o))throw new Error("A sequencer event must have an instrument as property");return n.instrument=o,createEvent("audio","note",n)};module.exports={"class":evClass,type:evType,property:evProp,createAudioNote:createAudioNote};
},{}],9:[function(_dereq_,module,exports){
"use strict";var timer=null,interval=100,worker=function(t){t.addEventListener("message",function(e){"start"===e.data?timer=setInterval(function(){t.postMessage("tick")},interval):"stop"===e.data?clearInterval(timer):e.data.interval&&(interval=e.data.interval,timer&&(clearInterval(timer),timer=setInterval(function(){t.postMessage("tick")},interval)))})};module.exports=worker;
},{}]},{},[1])


//# sourceMappingURL=dist/intermix.map.json